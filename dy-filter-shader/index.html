<!doctype html><html lang=zh-cn><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.82.0"><meta name=theme-color content="#fff"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>å®ç°æŠ–éŸ³ç‰¹æ•ˆæ»¤é•œ | Dev - jw</title><link rel=stylesheet href=../css/meme.min.ae509b8259cb6c090411be6371211f6bb00631055ec9b68a994f27bb5f5f5f76.css><script src=../js/meme.min.3a56ecbb4ec7b23a805fc0116d4dac9095813dfd877cd8379675a8bdac538ffe.js></script><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap" media=print onload="this.media='all'"><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&family=Noto+Serif+SC:wght@400;500;700&family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript><meta name=author content="Dev - jw"><meta name=description content="æœ¬æ–‡å°†é€šè¿‡ GLSL æ¥æ¨¡ä»¿æŠ–éŸ³ä¸­å‡ ç§ç‰¹æ•ˆçš„å®ç°ã€‚ åŠ¨ç”» æŠ–éŸ³ä¸Šçš„ç‰¹æ•ˆéƒ½æ˜¯åŠ¨æ€çš„ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆæŠŠåŠ¨æ€â€¦â€¦"><link rel="shortcut icon" href=../favicon.ico type=image/x-icon><link rel=mask-icon href=../icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=../icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="Dev - jw"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="Dev - jw"><meta name=msapplication-starturl content="../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../icons/mstile-150x150.png"><link rel=manifest href=../manifest.json><link rel=canonical href=https://dev.hjw.best/dy-filter-shader/><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","datePublished":"2020-08-13T19:37:01+08:00","dateModified":"2021-03-31T15:42:56+08:00","url":"https://dev.hjw.best/dy-filter-shader/","name":"å®ç°æŠ–éŸ³ç‰¹æ•ˆæ»¤é•œ","description":"æœ¬æ–‡å°†é€šè¿‡ GLSL æ¥æ¨¡ä»¿æŠ–éŸ³ä¸­å‡ ç§ç‰¹æ•ˆçš„å®ç°ã€‚ åŠ¨ç”» æŠ–éŸ³ä¸Šçš„ç‰¹æ•ˆéƒ½æ˜¯åŠ¨æ€çš„ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆæŠŠåŠ¨æ€â€¦â€¦","image":"https://dev.hjw.best/favicon.ico","license":"Copyright","publisher":{"@type":"Organization","name":"Dev - jw","logo":{"@type":"ImageObject","url":"https://dev.hjw.best/favicon.ico"},"url":"https://dev.hjw.best/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://dev.hjw.best/"}}</script><meta name=twitter:card content="summary"><meta property="og:title" content="å®ç°æŠ–éŸ³ç‰¹æ•ˆæ»¤é•œ"><meta property="og:description" content="æœ¬æ–‡å°†é€šè¿‡ GLSL æ¥æ¨¡ä»¿æŠ–éŸ³ä¸­å‡ ç§ç‰¹æ•ˆçš„å®ç°ã€‚ åŠ¨ç”» æŠ–éŸ³ä¸Šçš„ç‰¹æ•ˆéƒ½æ˜¯åŠ¨æ€çš„ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆæŠŠåŠ¨æ€â€¦â€¦"><meta property="og:url" content="https://dev.hjw.best/dy-filter-shader/"><meta property="og:site_name" content="Dev - jw"><meta property="og:locale" content="zh"><meta property="og:image" content="https://dev.hjw.best/favicon.ico"><meta property="og:type" content="website"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Lato:wght@700&text=reuixiy&display=swap" media=print onload="this.media='all'"><noscript><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Lato:wght@700&text=reuixiy&display=swap"></noscript><meta name=baidu-site-verification content="5nzYjT6RG7"></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=../ class=brand>Dev - jw</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=../about><span class=menu-item-name>å…³äº</span></a></li><li class=menu-item><a id=theme-switcher href=#><span class="icon theme-icon-light">ğŸŒ</span><span class="icon theme-icon-dark">ğŸŒ™</span></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label><label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=default data-type=posts data-toc-num=true><h1 class="post-title p-name">å®ç°æŠ–éŸ³ç‰¹æ•ˆæ»¤é•œ</h1><div class=post-meta><time datetime=2020-08-13T19:37:01+08:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2020-08-13</time></div><div class="post-body e-content"><p>æœ¬æ–‡å°†é€šè¿‡ GLSL æ¥æ¨¡ä»¿æŠ–éŸ³ä¸­å‡ ç§ç‰¹æ•ˆçš„å®ç°ã€‚</p><h3 id=åŠ¨ç”»><a href=#åŠ¨ç”» class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>åŠ¨ç”»</h3><p>æŠ–éŸ³ä¸Šçš„ç‰¹æ•ˆéƒ½æ˜¯åŠ¨æ€çš„ï¼Œé‚£ä¹ˆè¦æ€ä¹ˆæŠŠåŠ¨æ€çš„æ•ˆæœï¼ŒåŠ åˆ°ä¸€ä¸ªé™æ€çš„å›¾ç‰‡ä¸Šå‘¢ï¼Ÿ</p><p>åœ¨ <code>UIKit</code> ä¸­å®ç°åŠ¨ç”»ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ä½¿ç”¨ <code>CoreAnimation</code>æ¥é«˜æ•ˆã€æ–¹ä¾¿åœ°å®ç°åŠ¨ç”»ï¼Œè€Œ <code>CoreAnimation</code> çš„èŒè´£å°±æ˜¯å°½å¯èƒ½å¿«åœ°ç»„åˆå±å¹•ä¸Šä¸åŒçš„å¯è§†å†…å®¹ï¼Œ<strong>é€å¸§è®¡ç®—</strong>å½“å‰æ˜¾ç¤ºçš„å†…å®¹ã€‚</p><p><strong>é€å¸§è®¡ç®—</strong></p><p>åœ¨ OpenGL ES ä¸­ï¼Œæˆ‘ä»¬å®ç°åŠ¨ç”»çš„æ–¹å¼ï¼Œå°±æ˜¯è®¡ç®—æ¯ä¸€å¸§åº”è¯¥æ˜¾ç¤ºçš„å›¾åƒï¼Œç„¶ååœ¨å±å¹•åˆ·æ–°çš„æ—¶å€™ï¼Œé‡æ–°æ¸²æŸ“ã€‚</p><p>è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ˜¯æ”¾åœ¨ Shader ä¸­è¿›è¡Œçš„ã€‚</p><p>é€šè¿‡ä¸€ä¸ªè¡¨ç¤ºæ—¶é—´çš„å‚æ•°ï¼Œåœ¨é‡æ–°æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼ å…¥å½“å‰çš„æ—¶é—´ï¼Œè®© Shader è®¡ç®—å½“å‰åŠ¨ç”»çš„è¿›åº¦ã€‚</p><p>é‡æ–°æ¸²æŸ“ï¼Œåˆ™ä¾èµ– <code>CADisplayLink</code>æ¥å®ç°ã€‚</p><h4 id=ç¼©æ”¾><a href=#ç¼©æ”¾ class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>ç¼©æ”¾</h4><p><img src=https://w-md.imzsy.design/image-20200818191824078.png alt=image-20200818191824078></p><p><strong>åŸç†</strong></p><p>é€šè¿‡ä¿®æ”¹é¡¶ç‚¹åæ ‡å’Œçº¹ç†åæ ‡çš„æ˜ å°„å…³ç³»æ¥å®ç°</p><p><strong>ç€è‰²å™¨ä»£ç </strong></p><p>ç¼©æ”¾çš„å…³é”®ç‚¹æ˜¯åœ¨äºè®¡ç®—æŒ¯å¹…</p><ul><li><p><code>duration</code>è¡¨ç¤ºä¸€æ¬¡ç¼©æ”¾å‘¨æœŸçš„æ—¶é•¿</p></li><li><p><code>mod(Time, duration)</code>è¡¨ç¤ºä¼ å…¥çš„æ—¶é—´è½¬æ¢åˆ°ä¸€ä¸ªå‘¨æœŸå†…ï¼Œå³ <code>time</code> çš„èŒƒå›´æ˜¯ <code>0~0.6</code></p></li><li><p><code>amplitude</code>è¡¨ç¤ºæŒ¯å¹…ï¼Œè¿™é‡Œä½¿ç”¨ <code>sin</code> å‡½æ•°ï¼Œå°†æŒ¯å¹…èŒƒå›´æ§åˆ¶åœ¨ <code>1.0~1.3</code> ä¹‹é—´</p><p><img src=https://w-md.imzsy.design/image-20200818192510950.png alt=image-20200818192510950></p></li><li><p>å°†é¡¶ç‚¹åæ ‡çš„ x å’Œ y åˆ†åˆ«ä¹˜ä»¥æŒ¯å¹…ï¼Œåœ¨çº¹ç†åæ ‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå°±å¯ä»¥è¾¾åˆ°ç¼©æ”¾æ•ˆæœ</p></li></ul><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=k>attribute</span> <span class=k>vec4</span> <span class=n>position</span><span class=p>;</span>
<span class=k>attribute</span> <span class=k>vec2</span> <span class=n>inputTextureCoordinate</span><span class=p>;</span>
<span class=k>varying</span> <span class=k>vec2</span> <span class=n>textureCoordinate</span><span class=p>;</span>

<span class=c1>// æ—¶é—´æˆ³ï¼ˆéšç€å®šæ—¶å™¨çš„æ–¹æ³•è°ƒç”¨åŠæ—¶æ›´æ–°ï¼‰:ä»0å¼€å§‹ä¸€ç›´é€’å¢</span>
<span class=k>uniform</span> <span class=k>float</span> <span class=n>Time</span><span class=p>;</span>

<span class=k>const</span> <span class=k>float</span> <span class=n>PI</span> <span class=o>=</span> <span class=mf>3.1415926</span><span class=p>;</span>

<span class=k>void</span> <span class=n>main</span> <span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// ä¸€æ¬¡åŠ¨ç”»å‘¨æœŸæ—¶é•¿</span>
    <span class=k>float</span> <span class=n>duration</span> <span class=o>=</span> <span class=mf>0.6</span><span class=p>;</span>
  	<span class=c1>// æœ€å¤§ç¼©æ”¾é‡</span>
    <span class=k>float</span> <span class=n>maxAmplitude</span> <span class=o>=</span> <span class=mf>0.3</span><span class=p>;</span>
  	<span class=c1>// è¡¨ç¤ºä¼ å…¥çš„äº‹ä»¶å‘¨æœŸï¼Œå³timeçš„èŒƒå›´è¢«æ§åˆ¶åœ¨0.0~0.6</span>
  	<span class=c1>// mod(a, b)ï¼Œæ±‚æ¨¡è¿ç®— ç­‰ä»·äº a%bï¼ŒGLSLä¸­ä¸æ”¯æŒ%æ±‚æ¨¡</span>
    <span class=k>float</span> <span class=n>time</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>Time</span><span class=p>,</span> <span class=n>duration</span><span class=p>);</span>
    <span class=c1>// amplitudeè¡¨ç¤ºæŒ¯å¹…ï¼Œå¼•å…¥PIçš„ç›®çš„æ˜¯ä¸ºäº†ä½¿ç”¨sinå‡½æ•°ï¼Œå°†amplitudeçš„èŒƒå›´æ§åˆ¶åœ¨1.0 ~ 1.3ä¹‹é—´ï¼Œå¹¶éšç€æ—¶é—´å˜åŒ–</span>
    <span class=c1>// è¿™é‡Œå¯ä»¥ä¸ç”¨å–ç»å¯¹å€¼ï¼Œå› ä¸ºè§’åº¦çš„èŒƒå›´æ˜¯ã€0ï¼ŒÏ€ã€‘ï¼Œä¸ä¼šå‡ºç°è´Ÿæ•°çš„æƒ…å†µ</span>
    <span class=k>float</span> <span class=n>amplitude</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=n>maxAmplitude</span> <span class=o>*</span> <span class=n>abs</span><span class=p>(</span><span class=n>sin</span><span class=p>(</span><span class=n>time</span> <span class=o>*</span> <span class=p>(</span><span class=n>PI</span> <span class=o>/</span> <span class=n>duration</span><span class=p>)));</span>
    <span class=c1>// æ”¾å¤§å…³é”®ä»£ç ï¼šå°†é¡¶ç‚¹åæ ‡çš„xå’Œyåˆ†åˆ«ä¹˜ä»¥ä¸€ä¸ªæ”¾å¤§ç³»æ•°ï¼Œå³æŒ¯å¹…ï¼Œåœ¨çº¹ç†åæ ‡ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå°±è¾¾åˆ°äº†æ‹‰ä¼¸çš„æ•ˆæœ</span>
    <span class=c1>// xyæ”¾å¤§ï¼Œzwä¿æŒä¸å˜</span>
    <span class=n>gl_Position</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>position</span><span class=p>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>amplitude</span><span class=p>,</span> <span class=n>position</span><span class=p>.</span><span class=n>y</span> <span class=o>*</span> <span class=n>amplitude</span><span class=p>,</span> <span class=n>position</span><span class=p>.</span><span class=n>zw</span><span class=p>);</span>
    <span class=c1>// çº¹ç†åæ ‡ä¼ é€’ç»™textureCoordinate</span>
    <span class=n>textureCoordinate</span> <span class=o>=</span> <span class=n>inputTextureCoordinate</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><h4 id=çµé­‚å‡ºçª><a href=#çµé­‚å‡ºçª class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>çµé­‚å‡ºçª</h4><p><img src=https://w-md.imzsy.design/image-20200818193932331.png alt=image-20200818193932331></p><p><strong>åŸç†</strong></p><p>ä¸¤ä¸ªå±‚çš„å åŠ ï¼Œå¹¶ä¸”ä¸Šé¢çš„é‚£å±‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¼šé€æ¸æ”¾å¤§ä¸”é€æ˜åº¦é€æ¸é™ä½ã€‚</p><p><strong>ç€è‰²å™¨ä»£ç </strong></p><p>æ”¾å¤§çš„å…³é”®ç‚¹æ˜¯ <code>weakX</code> å’Œ <code>weakY</code> çš„è®¡ç®—ï¼Œ</p><p>æ¯”å¦‚<code>0.5 + (textureCoordinate.x - 0.5) / scale</code>ï¼Œå³å°†é¡¶ç‚¹åæ ‡å¯¹åº”çš„çº¹ç†åæ ‡çš„ <code>x</code> å€¼åˆ°çº¹ç†ä¸­ç‚¹çš„è·ç¦»ï¼Œç¼©å°ä¸€å®šçš„æ¯”ä¾‹</p><p>ä¸¤å±‚å åŠ çš„æ•ˆæœï¼Œæˆ‘ä»¬é€šè¿‡å¾—åˆ°ä¸¤ä¸ªçº¹ç†é¢œè‰²å€¼ <code>weakMask</code> å’Œ <code>mask</code>ï¼Œ</p><p>æ ¹æ®æ··åˆæ¨¡å¼ä¸­çš„æ­£å¸¸æ··åˆå…¬å¼ï¼š<strong>æœ€ç»ˆè‰² = åŸºè‰² * a% + æ··åˆè‰² * (1 - a%)</strong></p><blockquote><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>mix</code> å†…ç½®å‡½æ•°è¿›è¡Œçº¿æ€§æ··åˆ</p></blockquote><p><strong>å…³é”®ç‚¹åˆ†æ</strong></p><ul><li><p>è®¡ç®—å½“å‰åŠ¨ç”»è¿›åº¦çš„ç™¾åˆ†æ¯”</p><p><img src=https://w-md.imzsy.design/image-20200818195244854.png alt=image-20200818195244854></p></li><li><p>è®¡ç®—é€æ˜åº¦ã€ç¼©æ”¾å› å­</p><p><img src=https://w-md.imzsy.design/image-20200818195258991.png alt=image-20200818195258991></p></li><li><p>é¢œè‰²æ··åˆ</p><p><img src=https://w-md.imzsy.design/image-20200818195312976.png alt=image-20200818195312976></p></li></ul><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=k>precision</span> <span class=k>highp</span> <span class=k>float</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>inputImageTexture</span><span class=p>;</span>
<span class=k>varying</span> <span class=k>vec2</span> <span class=n>textureCoordinate</span><span class=p>;</span>
<span class=c1>// æ—¶é—´æˆ³</span>
<span class=k>uniform</span> <span class=k>float</span> <span class=n>Time</span><span class=p>;</span>

<span class=k>void</span> <span class=n>main</span> <span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// ä¸€æ¬¡åŠ¨ç”»å‘¨æœŸæ—¶é•¿</span>
    <span class=k>float</span> <span class=n>duration</span> <span class=o>=</span> <span class=mf>0.7</span><span class=p>;</span>
  	<span class=c1>// æœ€å¤§é€æ˜åº¦</span>
    <span class=k>float</span> <span class=n>maxAlpha</span> <span class=o>=</span> <span class=mf>0.4</span><span class=p>;</span>
  	<span class=c1>// æœ€å¤§ç¼©æ”¾å€¼</span>
    <span class=k>float</span> <span class=n>maxScale</span> <span class=o>=</span> <span class=mf>1.8</span><span class=p>;</span>
    <span class=c1>// å½“å‰åŠ¨ç”»è¿›åº¦(æ—¶é—´æˆ³ä¸æ—¶é•¿ä½¿ç”¨modå–æ¨¡), å†é™¤ä»¥æ—¶é•¿ å¾—åˆ°[0,1]</span>
    <span class=k>float</span> <span class=n>progress</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>Time</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span> <span class=o>/</span> <span class=n>duration</span><span class=p>;</span>
    <span class=c1>// å½“å‰é€æ˜åº¦[0.4, 0]</span>
    <span class=k>float</span> <span class=n>alpha</span> <span class=o>=</span> <span class=n>maxAlpha</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>progress</span><span class=p>);</span>
    <span class=c1>// å½“å‰ç¼©æ”¾å› å­[1.0, 1.8]</span>
    <span class=k>float</span> <span class=n>scale</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=p>(</span><span class=n>maxScale</span> <span class=o>-</span> <span class=mf>1.0</span><span class=p>)</span> <span class=o>*</span> <span class=n>progress</span><span class=p>;</span>
    <span class=c1>// å°†é¡¶ç‚¹åæ ‡å¯¹åº”çš„çº¹ç†åæ ‡çš„x/yå€¼åˆ°ä¸­å¿ƒç‚¹çš„è·ç¦»ï¼Œç¼©å°ä¸€å®šçš„æ¯”ä¾‹</span>
    <span class=k>float</span> <span class=n>weakX</span> <span class=o>=</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=p>(</span><span class=n>textureCoordinate</span><span class=p>.</span><span class=n>x</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>/</span> <span class=n>scale</span><span class=p>;</span>
    <span class=k>float</span> <span class=n>weakY</span> <span class=o>=</span> <span class=mf>0.5</span> <span class=o>+</span> <span class=p>(</span><span class=n>textureCoordinate</span><span class=p>.</span><span class=n>y</span> <span class=o>-</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>/</span> <span class=n>scale</span><span class=p>;</span>
    <span class=k>vec2</span> <span class=n>weakTextureCoords</span> <span class=o>=</span> <span class=k>vec2</span><span class=p>(</span><span class=n>weakX</span><span class=p>,</span> <span class=n>weakY</span><span class=p>);</span>
    <span class=c1>// è·å–å½“å‰åƒç´ ç‚¹çº¹ç†åæ ‡ï¼Œæ”¾å¤§åçš„çº¹ç†åæ ‡  </span>
    <span class=k>vec4</span> <span class=n>weakMask</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>weakTextureCoords</span><span class=p>);</span>
    <span class=c1>// è·å–åŸå§‹åƒç´ ç‚¹çº¹ç´ </span>
    <span class=k>vec4</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>textureCoordinate</span><span class=p>);</span>
    <span class=c1>// é¢œè‰²æ··åˆ å†…å»ºå‡½æ•°mix / æ··åˆæ–¹ç¨‹å¼</span>
    <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=n>mask</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>alpha</span><span class=p>)</span> <span class=o>+</span> <span class=n>weakMask</span> <span class=o>*</span> <span class=n>alpha</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><h4 id=æŠ–åŠ¨><a href=#æŠ–åŠ¨ class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>æŠ–åŠ¨</h4><p><img src=https://w-md.imzsy.design/image-20200818200441621.png alt=image-20200818200441621></p><p><strong>åŸç†</strong></p><p>é¢œè‰²åç§»+å¾®å¼±çš„æ”¾å¤§æ•ˆæœ</p><p><strong>ç€è‰²å™¨ä»£ç </strong></p><p>é¢œè‰²åç§»æ˜¯å¯¹ä¸‰ä¸ªé¢œè‰²é€šé“è¿›è¡Œåˆ†ç¦»ï¼Œå¹¶ä¸”ç»™çº¢è‰²é€šé“å’Œè“è‰²é€šé“æ·»åŠ äº†ä¸åŒçš„ä½ç½®åç§»</p><p><img src=https://w-md.imzsy.design/image-20200819114035428.png alt=image-20200819114035428></p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=k>precision</span> <span class=k>highp</span> <span class=k>float</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>inputImageTexture</span><span class=p>;</span>
<span class=k>varying</span> <span class=k>vec2</span> <span class=n>textureCoordinate</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>float</span> <span class=n>Time</span><span class=p>;</span>

<span class=k>void</span> <span class=n>main</span> <span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// ä¸€æ¬¡åŠ¨ç”»å‘¨æœŸæ—¶é•¿</span>
    <span class=k>float</span> <span class=n>duration</span> <span class=o>=</span> <span class=mf>0.7</span><span class=p>;</span>
    <span class=c1>// æœ€å¤§ç¼©æ”¾å€¼</span>
    <span class=k>float</span> <span class=n>maxScale</span> <span class=o>=</span> <span class=mf>1.1</span><span class=p>;</span>
  	<span class=c1>// é¢œè‰²åç§»çš„æ­¥é•¿</span>
    <span class=k>float</span> <span class=n>offset</span> <span class=o>=</span> <span class=mf>0.02</span><span class=p>;</span>
    <span class=c1>// å½“å‰åŠ¨ç”»è¿›åº¦</span>
    <span class=k>float</span> <span class=n>progress</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>Time</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span> <span class=o>/</span> <span class=n>duration</span><span class=p>;</span> <span class=c1>// 0~1</span>
    <span class=c1>// é¢œè‰²åç§»å€¼[0, 0.02]</span>
    <span class=k>vec2</span> <span class=n>offsetCoords</span> <span class=o>=</span> <span class=k>vec2</span><span class=p>(</span><span class=n>offset</span><span class=p>,</span> <span class=n>offset</span><span class=p>)</span> <span class=o>*</span> <span class=n>progress</span><span class=p>;</span>
    <span class=c1>// ç¼©æ”¾å› å­[1.0, 1.1]</span>
    <span class=k>float</span> <span class=n>scale</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>+</span> <span class=p>(</span><span class=n>maxScale</span> <span class=o>-</span> <span class=mf>1.0</span><span class=p>)</span> <span class=o>*</span> <span class=n>progress</span><span class=p>;</span>
    <span class=c1>// æ”¾å¤§åçš„çº¹ç†åæ ‡ </span>
    <span class=c1>// å‘é‡ä¸å‘é‡çš„åŠ å‡ä¹˜é™¤ï¼Œç»“æœè¿”å›çš„æ˜¯å‘é‡</span>
  	<span class=c1>// vec2(x, y) + vec2(a, b) = vec2(x + a, y + b);</span>
    <span class=k>vec2</span> <span class=n>ScaleTextureCoords</span> <span class=o>=</span> <span class=k>vec2</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>textureCoordinate</span> <span class=o>-</span> <span class=k>vec2</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>))</span> <span class=o>/</span> <span class=n>scale</span><span class=p>;</span>
    
  	<span class=c1>// è®¡ç®—é¢œè‰²åç§»</span>
    <span class=k>vec4</span> <span class=n>maskR</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>ScaleTextureCoords</span> <span class=o>+</span> <span class=n>offsetCoords</span><span class=p>);</span>
    <span class=k>vec4</span> <span class=n>maskB</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>ScaleTextureCoords</span> <span class=o>-</span> <span class=n>offsetCoords</span><span class=p>);</span>
    <span class=k>vec4</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>ScaleTextureCoords</span><span class=p>);</span>
    <span class=c1>// åˆ†åˆ«æå‰ 3 ä¸ªåç§»åçš„é¢œè‰²</span>
    <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>maskR</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>mask</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>maskB</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>mask</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><h4 id=é—ªç™½><a href=#é—ªç™½ class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>é—ªç™½</h4><p><img src=https://w-md.imzsy.design/image-20200818200425164.png alt=image-20200818200425164></p><p><strong>åŸç†</strong></p><p>å åŠ ä¸€ä¸ªç™½è‰²å±‚ï¼Œç„¶åç™½è‰²å±‚çš„é€æ˜åº¦éšç€æ—¶é—´ä¸æ–­åœ°å˜åŒ–</p><p><strong>ç€è‰²å™¨ä»£ç </strong></p><p>å‚è€ƒã€Œçµé­‚å‡ºçªã€çš„åˆ—å­ï¼Œå¯¹ä¸¤ä¸ªå±‚å®ç°å åŠ ï¼Œè¿™é‡Œæ— éæ˜¯åˆ›å»ºäº†ä¸€ä¸ªç™½è‰²å±‚ <code>whiteMask</code>ï¼Œå†æ ¹æ®æ··åˆæ–¹ç¨‹å¼è¿›è¡Œæ··åˆ</p><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=k>precision</span> <span class=k>highp</span> <span class=k>float</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>inputImageTexture</span><span class=p>;</span>
<span class=k>varying</span> <span class=k>vec2</span> <span class=n>textureCoordinate</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>float</span> <span class=n>Time</span><span class=p>;</span>

<span class=k>const</span> <span class=k>float</span> <span class=n>PI</span> <span class=o>=</span> <span class=mf>3.1415926</span><span class=p>;</span>

<span class=k>void</span> <span class=n>main</span> <span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>float</span> <span class=n>duration</span> <span class=o>=</span> <span class=mf>0.6</span><span class=p>;</span>
    
    <span class=k>float</span> <span class=n>time</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>Time</span><span class=p>,</span> <span class=n>duration</span><span class=p>);</span>
    
    <span class=k>vec4</span> <span class=n>whiteMask</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>
    <span class=k>float</span> <span class=n>amplitude</span> <span class=o>=</span> <span class=n>abs</span><span class=p>(</span><span class=n>sin</span><span class=p>(</span><span class=n>time</span> <span class=o>*</span> <span class=p>(</span><span class=n>PI</span> <span class=o>/</span> <span class=n>duration</span><span class=p>)));</span>
    
    <span class=k>vec4</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>textureCoordinate</span><span class=p>);</span>
    
    <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=n>mask</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=n>amplitude</span><span class=p>)</span> <span class=o>+</span> <span class=n>whiteMask</span> <span class=o>*</span> <span class=n>amplitude</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><h4 id=æ¯›åˆº><a href=#æ¯›åˆº class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>æ¯›åˆº</h4><p><img src=https://w-md.imzsy.design/image-20200819113031611.png alt=image-20200819113031611></p><p><strong>åŸç†</strong></p><p>æ’•è£‚ + å¾®å¼±çš„é¢œè‰²åç§»ã€‚</p><p><strong>æ’•è£‚</strong></p><p>è®©æ¯ä¸€è¡Œåƒç´ éšæœºåç§»<code>[-1, 1]</code>çš„è·ç¦»ï¼ˆè¿™é‡Œçš„ <code>-1 ~ 1</code> æ˜¯å¯¹äºçº¹ç†åæ ‡æ¥è¯´çš„ï¼‰ï¼Œ ä½†æ˜¯å¦‚æœæ•´ä¸ªç”»é¢éƒ½åç§»æ¯”è¾ƒå¤§çš„å€¼ï¼Œé‚£å¯èƒ½éƒ½çœ‹ä¸å‡ºåŸæ¥å›¾åƒçš„æ ·å­ã€‚</p><p><strong>è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼Œå°äºè¿™ä¸ªé˜ˆå€¼æ‰è¿›è¡Œåç§»ï¼Œè¶…è¿‡è¿™ä¸ªé˜ˆå€¼åˆ™ä¹˜ä¸Šä¸€ä¸ªç¼©å°ç³»æ•°</strong></p><p><strong>ç€è‰²å™¨ä»£ç </strong></p><ul><li><p>åƒç´ éšæœºåç§»å€¼</p><p><img src=https://w-md.imzsy.design/image-20200819114922227.png alt=image-20200819114922227></p></li><li><p>çº¹ç†åæ ‡ X çš„åç§»</p><p><img src=https://w-md.imzsy.design/image-20200819115012832.png alt=image-20200819115012832></p></li></ul><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=k>precision</span> <span class=k>highp</span> <span class=k>float</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>inputImageTexture</span><span class=p>;</span>
<span class=k>varying</span> <span class=k>vec2</span> <span class=n>textureCoordinate</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>float</span> <span class=n>Time</span><span class=p>;</span>

<span class=k>const</span> <span class=k>float</span> <span class=n>PI</span> <span class=o>=</span> <span class=mf>3.1415926</span><span class=p>;</span>
<span class=c1>// å™ªå£°å‡½æ•°ï¼Œä¼ªéšæœºå‡½æ•°ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª Hash å‡½æ•°</span>
<span class=k>float</span> <span class=n>rand</span><span class=p>(</span><span class=k>float</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// fract(x)è¿”å›xçš„å°æ•°éƒ¨åˆ†</span>
    <span class=c1>// è¿”å› sin(n) * 43758.5453123</span>
    <span class=c1>// sin(n) * æå¤§å€¼ï¼Œå¸¦å°æ•°ç‚¹ï¼Œæƒ³è¦éšæœºæ•°ç®—çš„æ¯”è¾ƒä½ï¼Œä¹˜çš„æ•°å°±å¿…é¡»è¾ƒå¤§</span>
    <span class=c1>// å¦‚æœæƒ³å¾—åˆ°ã€0ï¼Œ1ã€‘èŒƒå›´çš„å°æ•°å€¼ï¼Œå¯ä»¥å°†sin * 1</span>
    <span class=c1>// å¦‚æœåªä¿ç•™å°æ•°éƒ¨åˆ†ï¼Œä¹˜ä»¥ä¸€ä¸ªæå¤§å€¼</span>
    <span class=k>return</span> <span class=n>fract</span><span class=p>(</span><span class=n>sin</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=o>*</span> <span class=mf>43758.5453123</span><span class=p>);</span>
<span class=p>}</span>

<span class=k>void</span> <span class=n>main</span> <span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
  	<span class=c1>// æœ€å¤§æ’•è£‚å€¼</span>
    <span class=k>float</span> <span class=n>maxJitter</span> <span class=o>=</span> <span class=mf>0.06</span><span class=p>;</span>
  	<span class=c1>// ä¸€ä¸ªåŠ¨ç”»å‘¨æœŸæ—¶é•¿</span>
  	<span class=k>float</span> <span class=n>duration</span> <span class=o>=</span> <span class=mf>0.3</span><span class=p>;</span>
  	<span class=c1>// çº¢è‰²é¢œè‰²æœ€å¤§åç§»å€¼</span>
    <span class=k>float</span> <span class=n>colorROffset</span> <span class=o>=</span> <span class=mf>0.01</span><span class=p>;</span>
  	<span class=c1>// è“è‰²é¢œè‰²æœ€å¤§åç§»å€¼</span>
    <span class=k>float</span> <span class=n>colorBOffset</span> <span class=o>=</span> <span class=o>-</span><span class=mf>0.025</span><span class=p>;</span>
    <span class=c1>// å½“å‰åŠ¨ç”»è¿›åº¦</span>
    <span class=k>float</span> <span class=n>time</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>Time</span><span class=p>,</span> <span class=n>duration</span> <span class=o>*</span> <span class=mf>2.0</span><span class=p>);</span>
  	<span class=c1>// å½“å‰çš„æŒ¯å¹…</span>
    <span class=k>float</span> <span class=n>amplitude</span> <span class=o>=</span> <span class=n>max</span><span class=p>(</span><span class=n>sin</span><span class=p>(</span><span class=n>time</span> <span class=o>*</span> <span class=p>(</span><span class=n>PI</span> <span class=o>/</span> <span class=n>duration</span><span class=p>)),</span> <span class=mf>0.0</span><span class=p>);</span>
    <span class=c1>// åƒç´ éšæœºåç§»èŒƒå›´[-1,1]</span>
    <span class=k>float</span> <span class=n>jitter</span> <span class=o>=</span> <span class=n>rand</span><span class=p>(</span><span class=n>textureCoordinate</span><span class=p>.</span><span class=n>y</span><span class=p>)</span> <span class=o>*</span> <span class=mf>2.0</span> <span class=o>-</span> <span class=mf>1.0</span><span class=p>;</span> <span class=c1>// -1~1</span>
  	<span class=c1>// åˆ¤æ–­æ˜¯å¦éœ€è¦åç§»ï¼Œï¼ˆjitter &lt; æœ€å¤§æ’•è£‚å€¼ * å½“å‰æŒ¯å¹…)</span>
    <span class=k>bool</span> <span class=n>needOffset</span> <span class=o>=</span> <span class=n>abs</span><span class=p>(</span><span class=n>jitter</span><span class=p>)</span> <span class=o>&lt;</span> <span class=n>maxJitter</span> <span class=o>*</span> <span class=n>amplitude</span><span class=p>;</span>
    <span class=c1>// æ ¹æ® needOffset æ¥è®¡ç®—çº¹ç†åæ ‡ x</span>
  	<span class=c1>// needOffset = YESï¼Œåˆ™æ’•è£‚å¤§</span>
    <span class=c1>// needOffset = NOï¼Œåˆ™æ’•è£‚å°ï¼Œéœ€è¦é™ä½æ’•è£‚ = *æŒ¯å¹…*éå¸¸ç»†å¾®çš„æ•°</span>
    <span class=k>float</span> <span class=n>textureX</span> <span class=o>=</span> <span class=n>textureCoordinate</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=p>(</span><span class=n>needOffset</span> <span class=o>?</span> <span class=n>jitter</span> <span class=o>:</span> <span class=p>(</span><span class=n>jitter</span> <span class=o>*</span> <span class=n>amplitude</span> <span class=o>*</span> <span class=mf>0.006</span><span class=p>));</span>
    <span class=k>vec2</span> <span class=n>textureCoords</span> <span class=o>=</span> <span class=k>vec2</span><span class=p>(</span><span class=n>textureX</span><span class=p>,</span> <span class=n>textureCoordinate</span><span class=p>.</span><span class=n>y</span><span class=p>);</span>
  	
  	<span class=c1>// æ’•è£‚åçš„é¢œè‰²</span>
    <span class=k>vec4</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>textureCoords</span><span class=p>);</span>
    <span class=c1>// é¢œè‰²åç§»ï¼šåˆ†åˆ«è·å– Rã€B åç§»åçš„é¢œè‰²å€¼</span>
    <span class=k>vec4</span> <span class=n>maskR</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>textureCoords</span> <span class=o>+</span> <span class=k>vec2</span><span class=p>(</span><span class=n>colorROffset</span> <span class=o>*</span> <span class=n>amplitude</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>));</span>
    <span class=k>vec4</span> <span class=n>maskB</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>textureCoords</span> <span class=o>+</span> <span class=k>vec2</span><span class=p>(</span><span class=n>colorBOffset</span> <span class=o>*</span> <span class=n>amplitude</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>));</span>
    
    <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>maskR</span><span class=p>.</span><span class=n>r</span><span class=p>,</span> <span class=n>mask</span><span class=p>.</span><span class=n>g</span><span class=p>,</span> <span class=n>maskB</span><span class=p>.</span><span class=n>b</span><span class=p>,</span> <span class=n>mask</span><span class=p>.</span><span class=n>a</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div><p>åƒç´ éšæœºåç§»éœ€è¦ç”¨åˆ°éšæœºæ•°ï¼Œå¯æƒœ GLSL ä¸­å¹¶æ²¡æœ‰å†…ç½®çš„éšæœºå‡½æ•°ã€‚</p><p>è¿™ä¸ª <code>float rand(float n)</code> çš„å®ç°çœ‹ä¸Šå»å¾ˆç¥å¥‡ï¼Œå®ƒå…¶å®æ˜¯æ¥è‡ª <a href=https://gist.github.com/patriciogonzalezvivo/670c22f3966e662d2f83 target=_blank rel=noopener>è¿™é‡Œ</a> ï¼Œæ±Ÿæ¹–äººç§°ã€Œå™ªå£°å‡½æ•°ã€ã€‚</p><p>å®ƒå…¶å®æ˜¯ä¸€ä¸ªä¼ªéšæœºå‡½æ•°ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Hash å‡½æ•°ã€‚ä½†åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“æˆéšæœºå‡½æ•°æ¥ä½¿ç”¨ï¼Œå®ƒçš„è¿”å›å€¼èŒƒå›´æ˜¯ <code>0 ~ 1</code>ã€‚å¦‚æœä½ å¯¹è¿™ä¸ªå‡½æ•°æƒ³äº†è§£æ›´å¤šçš„è¯å¯ä»¥çœ‹ <a href=https://xiaoiver.github.io/coding/2018/08/01/%E5%99%AA%E5%A3%B0%E7%9A%84%E8%89%BA%E6%9C%AF.html target=_blank rel=noopener>è¿™é‡Œ</a> ã€‚</p><h4 id=å¹»è§‰><a href=#å¹»è§‰ class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>å¹»è§‰</h4><p><strong>åŸç†</strong></p><p><img src=https://w-md.imzsy.design/image-20200819113810451.png alt=image-20200819113810451></p><p>æ®‹å½±+é¢œè‰²åç§»</p><p><strong>æ®‹å½±</strong></p><p>åœ¨ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ç»è¿‡ä¸€æ®µæ—¶é—´é—´éš”ï¼Œæ ¹æ®å½“å‰çš„ä½ç½®å»åˆ›å»ºä¸€ä¸ªæ–°å±‚ï¼Œå¹¶ä¸”æ–°å±‚çš„ä¸é€æ˜åº¦éšç€æ—¶é—´é€æ¸å‡å¼±</p><p><strong>é¢œè‰²åç§»</strong></p><p>å›¾ç‰‡åœ¨ç§»åŠ¨çš„è¿‡ç¨‹ä¸­æ˜¯è“è‰²åœ¨å‰ï¼Œçº¢è‰²åœ¨åï¼Œå³åœ¨ç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œæ¯é—´éš”ä¸€æ®µæ—¶é—´ï¼Œé—å¤±äº†ä¸€éƒ¨åˆ†çº¢è‰²é€šé“çš„å€¼åœ¨åŸæ¥çš„ä½ç½®ï¼Œå¹¶ä¸”è¿™éƒ¨åˆ†çº¢è‰²é€šé“çš„å€¼ï¼Œéšç€æ—¶é—´åç§»ï¼Œä¼šé€æ¸æ¢å¤</p><p><strong>ç€è‰²å™¨ä»£ç </strong></p><ul><li><p>getMask å‡½æ•°ï¼Œè®¡ç®—åœ¨æŸä¸ªæ—¶åˆ»å›¾ç‰‡çš„å…·ä½“ä½ç½®ã€‚é€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥æ¯ç»è¿‡ä¸€æ®µæ—¶é—´ï¼Œå»ç”Ÿæˆä¸€ä¸ªæ–°çš„å±‚ã€‚</p><p><img src=https://w-md.imzsy.design/image-20200819115606231.png alt=image-20200819115606231></p></li><li><p>forå¾ªç¯æ¥ç´¯åŠ æ¯ä¸€å±‚çš„æ¯ä¸ªé€šé“ä¹˜ä¸Šè‡ªèº«çš„é€æ˜åº¦çš„å€¼ï¼Œç®—å‡ºæœ€ç»ˆçš„é¢œè‰²å€¼ <code>resultMask</code> ã€‚</p><p><img src=https://w-md.imzsy.design/image-20200819115637726.png alt=image-20200819115637726></p></li></ul><div class=highlight><pre class=chroma><code class=language-glsl data-lang=glsl><span class=k>precision</span> <span class=k>highp</span> <span class=k>float</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>sampler2D</span> <span class=n>inputImageTexture</span><span class=p>;</span>
<span class=k>varying</span> <span class=k>vec2</span> <span class=n>textureCoordinate</span><span class=p>;</span>

<span class=k>uniform</span> <span class=k>float</span> <span class=n>Time</span><span class=p>;</span>

<span class=k>const</span> <span class=k>float</span> <span class=n>PI</span> <span class=o>=</span> <span class=mf>3.1415926</span><span class=p>;</span>
<span class=c1>// ä¸€æ¬¡åŠ¨ç”»å‘¨æœŸæ—¶é•¿</span>
<span class=k>const</span> <span class=k>float</span> <span class=n>duration</span> <span class=o>=</span> <span class=mf>2.0</span><span class=p>;</span>

<span class=c1>// è¿™ä¸ªå‡½æ•°å¯ä»¥è®¡ç®—å‡ºï¼Œåœ¨æŸä¸ªæ—¶åˆ»å›¾ç‰‡çš„å…·ä½“ä½ç½®ï¼Œé€šè¿‡å®ƒå¯ä»¥æ¯ç»è¿‡ä¸€æ®µæ—¶é—´ï¼Œå»ç”Ÿæˆä¸€ä¸ªæ–°çš„mask</span>
<span class=c1>// è½¬åœˆäº§ç”Ÿå¹»å½±çš„å•ä¸ªåƒç´ ç‚¹çš„é¢œè‰²å€¼</span>
<span class=k>vec4</span> <span class=n>getMask</span><span class=p>(</span><span class=k>float</span> <span class=n>time</span><span class=p>,</span> <span class=k>vec2</span> <span class=n>textureCoords</span><span class=p>,</span> <span class=k>float</span> <span class=n>padding</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// åœ†å¿ƒåæ ‡</span>
    <span class=k>vec2</span> <span class=n>translation</span> <span class=o>=</span> <span class=k>vec2</span><span class=p>(</span><span class=n>sin</span><span class=p>(</span><span class=n>time</span> <span class=o>*</span> <span class=p>(</span><span class=n>PI</span> <span class=o>*</span> <span class=mf>2.0</span> <span class=o>/</span> <span class=n>duration</span><span class=p>)),</span>
                            <span class=n>cos</span><span class=p>(</span><span class=n>time</span> <span class=o>*</span> <span class=p>(</span><span class=n>PI</span> <span class=o>*</span> <span class=mf>2.0</span> <span class=o>/</span> <span class=n>duration</span><span class=p>)));</span>
  	<span class=c1>// æ–°çš„çº¹ç†åæ ‡ = åŸå§‹çº¹ç†åæ ‡ + åç§»é‡ * åœ†å‘¨åæ ‡ï¼ˆæ–°çš„å›¾å±‚ä¸å›¾å±‚ä¹‹é—´æ˜¯æœ‰é—´è·çš„ï¼Œæ‰€ä»¥éœ€è¦åç§»ï¼‰</span>
    <span class=k>vec2</span> <span class=n>translationTextureCoords</span> <span class=o>=</span> <span class=n>textureCoords</span> <span class=o>+</span> <span class=n>padding</span> <span class=o>*</span> <span class=n>translation</span><span class=p>;</span>
    <span class=c1>// æ ¹æ®æ–°çš„çº¹ç†åæ ‡è·å–æ–°å›¾å±‚çš„çº¹ç´ </span>
  	<span class=k>vec4</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>texture2D</span><span class=p>(</span><span class=n>inputImageTexture</span><span class=p>,</span> <span class=n>translationTextureCoords</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>mask</span><span class=p>;</span>
<span class=p>}</span>

<span class=c1>// è¿™ä¸ªå‡½æ•°å¯ä»¥è®¡ç®—å‡ºï¼ŒæŸä¸ªæ—¶åˆ»åˆ›å»ºçš„å±‚ï¼Œåœ¨å½“å‰æ—¶åˆ»çš„é€æ˜åº¦</span>
<span class=k>float</span> <span class=n>maskAlphaProgress</span><span class=p>(</span><span class=k>float</span> <span class=n>currentTime</span><span class=p>,</span> <span class=k>float</span> <span class=n>hideTime</span><span class=p>,</span> <span class=k>float</span> <span class=n>startTime</span><span class=p>)</span> <span class=p>{</span>
  	<span class=c1>// modï¼ˆæ—¶é•¿+æŒç»­æ—¶é—´ - å¼€å§‹æ—¶é—´ï¼Œæ—¶é•¿ï¼‰å¾—åˆ°ä¸€ä¸ªå‘¨æœŸå†…çš„time</span>
    <span class=k>float</span> <span class=n>time</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>duration</span> <span class=o>+</span> <span class=n>currentTime</span> <span class=o>-</span> <span class=n>startTime</span><span class=p>,</span> <span class=n>duration</span><span class=p>);</span>
    <span class=c1>// å¦‚æœå°äº0.9ï¼Œè¿”å›timeï¼Œåä¹‹ï¼Œè¿”å›0.9</span>
    <span class=k>return</span> <span class=n>min</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>hideTime</span><span class=p>);</span>
<span class=p>}</span>

<span class=k>void</span> <span class=n>main</span> <span class=p>(</span><span class=k>void</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// å°†ä¼ å…¥çš„æ—¶é—´æˆ³è½¬æ¢åˆ°ä¸€ä¸ªå‘¨æœŸå†…ï¼Œtimeçš„èŒƒå›´æ˜¯ã€0ï¼Œ2ã€‘</span>
    <span class=c1>// è·å¾—æ—¶é—´å‘¨æœŸ</span>
    <span class=k>float</span> <span class=n>time</span> <span class=o>=</span> <span class=n>mod</span><span class=p>(</span><span class=n>Time</span><span class=p>,</span> <span class=n>duration</span><span class=p>);</span>
    <span class=c1>// æ”¾å¤§åçš„å€æ•°</span>
    <span class=k>float</span> <span class=n>scale</span> <span class=o>=</span> <span class=mf>1.2</span><span class=p>;</span>
    <span class=c1>// åç§»é‡ = 0.083</span>
    <span class=k>float</span> <span class=n>padding</span> <span class=o>=</span> <span class=mf>0.5</span> <span class=o>*</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>-</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>scale</span><span class=p>);</span>
    <span class=c1>// æ”¾å¤§åçš„çº¹ç†åæ ‡</span>
    <span class=k>vec2</span> <span class=n>textureCoords</span> <span class=o>=</span> <span class=k>vec2</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>textureCoordinate</span> <span class=o>-</span> <span class=k>vec2</span><span class=p>(</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>))</span> <span class=o>/</span> <span class=n>scale</span><span class=p>;</span>
    <span class=c1>// æ–°å»ºå±‚çš„éšè—æ—¶é—´ å³æ–°å»ºå±‚ä»€ä¹ˆæ—¶å€™éšè— </span>
    <span class=k>float</span> <span class=n>hideTime</span> <span class=o>=</span> <span class=mf>0.9</span><span class=p>;</span>
    <span class=c1>// æ—¶é—´é—´éš”ï¼šéš”0.2såˆ›å»ºä¸€ä¸ªæ–°å±‚</span>
    <span class=k>float</span> <span class=n>timeGap</span> <span class=o>=</span> <span class=mf>0.2</span><span class=p>;</span>
    <span class=c1>// æ³¨æ„ï¼šåªä¿ç•™äº†çº¢è‰²çš„é€æ˜çš„é€šé“å€¼ï¼Œå› ä¸ºå¹»è§‰æ•ˆæœæ®‹ç•™çº¢è‰²</span>
    <span class=c1>// å¹»å½±æ®‹ç•™æ•°æ®</span>
    <span class=k>float</span> <span class=n>maxAlphaR</span> <span class=o>=</span> <span class=mf>0.5</span><span class=p>;</span> <span class=c1>// max R</span>
    <span class=k>float</span> <span class=n>maxAlphaG</span> <span class=o>=</span> <span class=mf>0.05</span><span class=p>;</span> <span class=c1>// max G</span>
    <span class=k>float</span> <span class=n>maxAlphaB</span> <span class=o>=</span> <span class=mf>0.05</span><span class=p>;</span> <span class=c1>// max B</span>
        
  	<span class=c1>// è·å–æ–°çš„å›¾å±‚çš„åæ ‡ï¼Œéœ€è¦ä¼ å…¥æ—¶é—´ã€çº¹ç†åæ ‡ã€åç§»é‡</span>
    <span class=k>vec4</span> <span class=n>mask</span> <span class=o>=</span> <span class=n>getMask</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>textureCoords</span><span class=p>,</span> <span class=n>padding</span><span class=p>);</span>
    <span class=k>float</span> <span class=n>alphaR</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>;</span> <span class=c1>// R</span>
    <span class=k>float</span> <span class=n>alphaG</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>;</span> <span class=c1>// G</span>
    <span class=k>float</span> <span class=n>alphaB</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>;</span> <span class=c1>// B</span>
    
    <span class=c1>// æœ€ç»ˆå›¾å±‚é¢œè‰²ï¼šåˆå§‹åŒ–</span>
    <span class=k>vec4</span> <span class=n>resultMask</span> <span class=o>=</span> <span class=k>vec4</span><span class=p>(</span><span class=mo>0</span><span class=p>,</span> <span class=mo>0</span><span class=p>,</span> <span class=mo>0</span><span class=p>,</span> <span class=mo>0</span><span class=p>);</span>
    
   	<span class=c1>// å¾ªç¯ï¼šæ¯ä¸€å±‚å¾ªç¯éƒ½ä¼šå¾—åˆ°æ–°çš„å›¾å±‚çš„é¢œè‰²ï¼Œå³å¹»å½±é¢œè‰²</span>
    <span class=c1>// ä¸€æ¬¡å¾ªç¯åªæ˜¯è®¡ç®—ä¸€ä¸ªåƒç´ ç‚¹çš„çº¹ç´ ï¼Œéœ€è¦åœ¨çœŸæœºè¿è¡Œã€‚æ¨¡æ‹Ÿå™¨ä¼šå¡ï¼Œä¸»è¦æ˜¯æ¨¡æ‹Ÿå™¨ä¸Šæ˜¯CPUæ¨¡æ‹ŸGPUçš„</span>
    <span class=k>for</span> <span class=p>(</span><span class=k>float</span> <span class=n>f</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span> <span class=n>f</span> <span class=o>&lt;</span> <span class=n>duration</span><span class=p>;</span> <span class=n>f</span> <span class=o>+=</span> <span class=n>timeGap</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>float</span> <span class=n>tmpTime</span> <span class=o>=</span> <span class=n>f</span><span class=p>;</span>
        <span class=c1>// è·å–åˆ°ã€0ï¼Œ2ã€‘så†…æ‰€è·å–çš„è¿åŠ¨åçš„çº¹ç†åæ ‡</span>
        <span class=c1>// è·å¾—å¹»å½±å½“å‰æ—¶é—´çš„é¢œè‰²å€¼</span>
        <span class=k>vec4</span> <span class=n>tmpMask</span> <span class=o>=</span> <span class=n>getMask</span><span class=p>(</span><span class=n>tmpTime</span><span class=p>,</span> <span class=n>textureCoords</span><span class=p>,</span> <span class=n>padding</span><span class=p>);</span>
      
        <span class=c1>// æŸä¸ªæ—¶åˆ»åˆ›å»ºçš„å±‚ï¼Œåœ¨å½“å‰æ—¶åˆ»çš„çº¢ç»¿è“çš„é€æ˜åº¦</span>
        <span class=c1>// ä¸´æ—¶çš„é€æ˜åº¦ = æ ¹æ®æ—¶é—´æ¨ç§»RGBçš„é€æ˜åº¦å‘ç”Ÿå˜åŒ–</span>
        <span class=c1>// è·å¾—ä¸´æ—¶çš„çº¢ç»¿è“é€æ˜åº¦</span>
        <span class=k>float</span> <span class=n>tmpAlphaR</span> <span class=o>=</span> <span class=n>maxAlphaR</span> <span class=o>-</span> <span class=n>maxAlphaR</span> <span class=o>*</span> <span class=n>maskAlphaProgress</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>hideTime</span><span class=p>,</span> <span class=n>tmpTime</span><span class=p>)</span> <span class=o>/</span> <span class=n>hideTime</span><span class=p>;</span>
        <span class=k>float</span> <span class=n>tmpAlphaG</span> <span class=o>=</span> <span class=n>maxAlphaG</span> <span class=o>-</span> <span class=n>maxAlphaG</span> <span class=o>*</span> <span class=n>maskAlphaProgress</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>hideTime</span><span class=p>,</span> <span class=n>tmpTime</span><span class=p>)</span> <span class=o>/</span> <span class=n>hideTime</span><span class=p>;</span>
        <span class=k>float</span> <span class=n>tmpAlphaB</span> <span class=o>=</span> <span class=n>maxAlphaB</span> <span class=o>-</span> <span class=n>maxAlphaB</span> <span class=o>*</span> <span class=n>maskAlphaProgress</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>hideTime</span><span class=p>,</span> <span class=n>tmpTime</span><span class=p>)</span> <span class=o>/</span> <span class=n>hideTime</span><span class=p>;</span>

        <span class=c1>// ç´¯è®¡æ¯ä¸€å±‚ä¸´æ—¶RGB * RGBçš„ä¸´æ—¶é€æ˜åº¦</span>
        <span class=c1>// ç»“æœ += ä¸´æ—¶é¢œè‰² * é€æ˜åº¦ï¼Œå³åˆšäº§ç”Ÿçš„å›¾å±‚çš„é¢œè‰²</span>
        <span class=n>resultMask</span> <span class=o>+=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>tmpMask</span><span class=p>.</span><span class=n>r</span> <span class=o>*</span> <span class=n>tmpAlphaR</span><span class=p>,</span>
                           <span class=n>tmpMask</span><span class=p>.</span><span class=n>g</span> <span class=o>*</span> <span class=n>tmpAlphaG</span><span class=p>,</span>
                           <span class=n>tmpMask</span><span class=p>.</span><span class=n>b</span> <span class=o>*</span> <span class=n>tmpAlphaB</span><span class=p>,</span>
                           <span class=mf>1.0</span><span class=p>);</span>
        <span class=c1>// é€æ˜åº¦é€’å‡</span>
        <span class=n>alphaR</span> <span class=o>-=</span> <span class=n>tmpAlphaR</span><span class=p>;</span>
        <span class=n>alphaG</span> <span class=o>-=</span> <span class=n>tmpAlphaG</span><span class=p>;</span>
        <span class=n>alphaB</span> <span class=o>-=</span> <span class=n>tmpAlphaB</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>// æœ€ç»ˆé¢œè‰² += åŸå§‹çº¹ç†çš„RGB * é€æ˜åº¦</span>
    <span class=n>resultMask</span> <span class=o>+=</span> <span class=k>vec4</span><span class=p>(</span><span class=n>mask</span><span class=p>.</span><span class=n>r</span> <span class=o>*</span> <span class=n>alphaR</span><span class=p>,</span> <span class=n>mask</span><span class=p>.</span><span class=n>g</span> <span class=o>*</span> <span class=n>alphaG</span><span class=p>,</span> <span class=n>mask</span><span class=p>.</span><span class=n>b</span> <span class=o>*</span> <span class=n>alphaB</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>);</span>

    <span class=n>gl_FragColor</span> <span class=o>=</span> <span class=n>resultMask</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><blockquote><p><strong>æ³¨ï¼š</strong> åœ¨ iOS çš„æ¨¡æ‹Ÿå™¨ä¸Šï¼Œåªèƒ½ç”¨ CPU æ¥æ¨¡æ‹Ÿ GPU çš„åŠŸèƒ½ã€‚æ‰€ä»¥åœ¨æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œä¸Šé¢çš„ä»£ç æ—¶ï¼Œå¯èƒ½ä¼šååˆ†å¡é¡¿ã€‚å°¤å…¶æ˜¯æœ€åè¿™ä¸ªæ•ˆæœï¼Œç”±äºè®¡ç®—é‡å¤ªå¤§ï¼Œäº²æµ‹æ¨¡æ‹Ÿå™¨æ˜¾ç¤ºä¸å‡ºæ¥ã€‚å› æ­¤å¦‚æœè¦è·‘ä»£ç ï¼Œæœ€å¥½ä½¿ç”¨çœŸæœºè¿è¡Œã€‚</p></blockquote><p>æ–‡ä¸­ç€è‰²å™¨<a href=https://github.com/dev-jw/Learning-OpenGL-ES target=_blank rel=noopener>ä»£ç è·å–</a></p><h3 id=å‚è€ƒ><a href=#å‚è€ƒ class=anchor-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon anchor-icon"><path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96.0-59.27-59.26-59.27-155.7.0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757.0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037.0 01-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482.0 0120.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96.0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454.0 0020.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037.0 00-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639.0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z"/></svg></a>å‚è€ƒ</h3><p><a href=http://www.lymanli.com/2019/04/05/ios-opengles-filter/ target=_blank rel=noopener>åœ¨ iOS ä¸­ä½¿ç”¨ GLSL å®ç°æŠ–éŸ³ç‰¹æ•ˆ</a></p><p><a href=https://www.jianshu.com/p/5bb7f2a0da90 target=_blank rel=noopener>å½“ä¸€ä¸ª Android å¼€å‘ç©æŠ–éŸ³ç©ç–¯äº†ä¹‹å(äºŒ)</a></p><p><a href=https://www.jianshu.com/p/795193bde5fa target=_blank rel=noopener>åŠ¨æ•ˆæ»¤é•œ</a></p></div></article><div class=post-tags><a href=../tags/ios/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>iOS</a>
<a href=../tags/opengles/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>OpenGLES</a></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>Â©&nbsp;2019â€“2021&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;Dev - jw</div></div></footer></div><script>'serviceWorker'in navigator&&window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js')})</script><script>typeof MathJax=='undefined'?(window.MathJax={loader:{load:['[tex]/mhchem']},options:{renderActions:{addMenu:[0,'','']}},tex:{inlineMath:{'[+]':[['$','$']]},tags:'ams',packages:{'[+]':['mhchem']}}},function(){var a=document.createElement('script');a.src='https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js',a.defer=!0,document.head.appendChild(a)}()):(MathJax.texReset(),MathJax.typeset())</script><script src=https://cdn.jsdelivr.net/npm/mermaid@8.8.3/dist/mermaid.min.js></script><script>let mermaidConfig={startOnLoad:!0,flowchart:{useMaxWidth:!1,htmlLabels:!0},theme:'default'};mermaid.initialize(mermaidConfig)</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script><script>mediumZoom(document.querySelectorAll('div.post-body img'),{background:'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script></body></html>